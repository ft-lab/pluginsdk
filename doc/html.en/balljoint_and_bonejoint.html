<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ball Joint and Bone</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.4 -->
<div id="top">
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('balljoint_and_bonejoint.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Ball Joint and Bone </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>See the following for the differences between Ball Joint and Bone.</p>
<ul>
<li>Cannot hold the value from Flat and Blend setting.<br/>
</li>
<li>Part Matrix (Returns matrix value from <a class="el" href="structsxsdk_1_1part__class.html#aefcefccfebaddcce5aff438be153f1b1" title="Get Transformation matrix.">sxsdk::part_class::get_transformation_matrix</a>) always returns Identity matrix.<br/>
</li>
<li>Always holding it's bone matrix (Return matrix value from <a class="el" href="structsxsdk_1_1bone__joint__interface.html#a905e706a7433e1184d0947857c12e587" title="Get bone transformation matrix.">sxsdk::bone_joint_interface::get_matrix</a>).<br/>
</li>
<li>Able to limit it's XYZ angle in local coordinate.</li>
</ul>
<p>The hierarchical structure of bone is always represent by Joint Rotation Matrix * Bone Matrix * Joint Offset</p>
<p>Also, the position returns from <a class="el" href="structsxsdk_1_1bone__joint__interface.html#a98c134d054cd6bdde0b8e616511a07d3" title="Get position.">sxsdk::bone_joint_interface::get_position</a> is the same result returns from <a class="el" href="structsxsdk_1_1bone__joint__interface.html#a905e706a7433e1184d0947857c12e587" title="Get bone transformation matrix.">sxsdk::bone_joint_interface::get_matrix</a>. So when their values are stored, they will get change mutually.</p>
<h2><a class="anchor" id="balljoint"></a>
Ball Joint</h2>
<p>Getting the center coordinate of the given ball join in world coordinate, please see the following sample codes when shape is reference by <a class="el" href="structsxsdk_1_1shape__class.html" title="Base class for handling operations common to all shapes.">sxsdk::shape_class</a>.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> sxsdk::mat4 lw_mat = <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_local_to_world_matrix();
 sxsdk::vec3 w_pos;
 <span class="keywordflow">if</span> (<a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_type() == <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a91e88b88c3d3a05405aed358be231335" title="blah">sxsdk::enums::part</a>) {
   <a class="code" href="structsxsdk_1_1part__class.html" title="Class that handles parts.">sxsdk::part_class</a> &amp;<a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a91e88b88c3d3a05405aed358be231335" title="blah">part</a> = <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_part();
   <span class="keywordflow">if</span> (part.<a class="code" href="structsxsdk_1_1shape__class.html#ade60842becfb8560dd8d047fd6f43e3e" title="edit makeheader.py Whether this is a ball joint or not.">is_ball_joint</a>()) {
     <a class="code" href="classcompointer.html" title="A smart pointer for reference counted *_interface classes.">compointer&lt;sxsdk::ball_joint_interface&gt;</a> <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868a1da82907a3a8ebace23ae5f2c9019692" title="blah">ball_joint</a>(part.<a class="code" href="structsxsdk_1_1shape__class.html#a73d0dd5b7cd1e8be9ee8067a246b5058" title="Get Interface to the ball joint.">get_ball_joint_interface</a>());
     <span class="keyword">const</span> sxsdk::vec3 pos          = <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868a1da82907a3a8ebace23ae5f2c9019692" title="blah">ball_joint</a>-&gt;get_position();
     <span class="keyword">const</span> sxsdk::vec3 joint_offset = <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868a1da82907a3a8ebace23ae5f2c9019692" title="blah">ball_joint</a>-&gt;get_offset();
     <span class="keyword">const</span> sxsdk::mat4 joint_rotate = sxsdk::mat4(<a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868a1da82907a3a8ebace23ae5f2c9019692" title="blah">ball_joint</a>-&gt;get_rotation());
     <span class="keyword">const</span> sxsdk::vec4 v4 = sxsdk::vec4(0, 0, 0, 1) * (joint_rotate * sxsdk::mat4::translate(joint_offset + pos)) * lw_mat;
     w_pos = sxsdk::vec3(v4.x, v4.y, v4.z);
   }
 }
</pre></div><p>The calculated w_pos value contained the center position in world coordinate.</p>
<p>In ball joint, if the joint has offset / rotate / position, then the transformation matrix can be obtained by multiply of the local coordinate matrix of the ball joint.<br/>
For local to world matrix conversion, with up-to one level upward parent of the selected object can be accumulated. (Not included it's own matrix)</p>
<p>Also, the same result of v4 can be get from the following calculation.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> sxsdk::mat4 m2 = inv(part.<a class="code" href="structsxsdk_1_1part__class.html#aefcefccfebaddcce5aff438be153f1b1" title="Get Transformation matrix.">get_transformation_matrix</a>()) * part.<a class="code" href="structsxsdk_1_1shape__class.html#accec615cd2d33a212a8d946076fb33fa" title="Get Transformation matrix.">get_transformation</a>();
 <span class="keyword">const</span> sxsdk::vec4 v4 = sxsdk::vec4(pos, 1) * m2 * lw_mat;
</pre></div><p>This calculation excluded it's own part matrix, but used the joint offset and rotation to get the value of m2 matrix.</p>
<h2><a class="anchor" id="bonejoint"></a>
Bone</h2>
<p>Bone has a similar structure with bone joint, but with a slightly different calculation.Getting the center coordinate of the given bone in world coordinate, please see the following sample codes when shape is reference by <a class="el" href="structsxsdk_1_1shape__class.html" title="Base class for handling operations common to all shapes.">sxsdk::shape_class</a>.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> sxsdk::mat4 lw_mat = <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_local_to_world_matrix();
 sxsdk::vec3 w_pos;
 <span class="keywordflow">if</span> (<a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_type() == <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a91e88b88c3d3a05405aed358be231335" title="blah">sxsdk::enums::part</a>) {
   <a class="code" href="structsxsdk_1_1part__class.html" title="Class that handles parts.">sxsdk::part_class</a> &amp;part = <a class="code" href="namespacesxsdk_1_1enums.html#aa6cc70b74636bfbf63bbfb8a2da2ce52a99454471eedb51f26cee16cf284688bc" title="blah">shape</a>.get_part();
   <span class="keywordflow">if</span> (part.<a class="code" href="structsxsdk_1_1shape__class.html#ab128c076deac78d5f2bf4e93b34e29c8" title="edit makeheader.py Whether this is a bone or not.">is_bone_joint</a>()) {
     <a class="code" href="classcompointer.html" title="A smart pointer for reference counted *_interface classes.">compointer&lt;sxsdk::bone_joint_interface&gt;</a> <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868aff44245b1dc3b6e72aff64f92fc4ebc4" title="blah">bone_joint</a>(part.<a class="code" href="structsxsdk_1_1shape__class.html#a7c8a47a52ecae91bfa03b4184429c8f1" title="Get Interface to the bone.">get_bone_joint_interface</a>());
     <span class="keyword">const</span> sxsdk::vec3 joint_offset = <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868aff44245b1dc3b6e72aff64f92fc4ebc4" title="blah">bone_joint</a>-&gt;get_offset();
     <span class="keyword">const</span> sxsdk::mat4 joint_rotate = sxsdk::mat4(<a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868aff44245b1dc3b6e72aff64f92fc4ebc4" title="blah">bone_joint</a>-&gt;get_rotation());
     <span class="keyword">const</span> sxsdk::mat4 m2 = <a class="code" href="namespacesxsdk_1_1enums.html#a6a30562e7449f2bab30d894a98327868aff44245b1dc3b6e72aff64f92fc4ebc4" title="blah">bone_joint</a>-&gt;get_matrix();
     <span class="keyword">const</span> sxsdk::vec4 v4 = sxsdk::vec4(0, 0, 0, 1) * joint_rotate * m2 * sxsdk::mat4::translate(joint_offset) * lw_mat;
     w_pos = sxsdk::vec3(v4.x, v4.y, v4.z);
   }
 }
</pre></div><p>The calculated w_pos value contained the center position in world coordinate.</p>
<p>In bone, it's own matrix (getting it from bone_joint-&gt;get_matrix()) and joint offset, then the transformation matrix can be obtained by multiply of the local coordinate matrix of the bone.</p>
<p>Also, the same result of v4 can be get from the following calculation.</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">const</span> sxsdk::vec4 v4 = sxsdk::vec4(0, 0, 0, 1) * part.<a class="code" href="structsxsdk_1_1shape__class.html#accec615cd2d33a212a8d946076fb33fa" title="Get Transformation matrix.">get_transformation</a>() * lw_mat;
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
<br><br>
<hr>
<div align="center">Copyright &copy; e frontier, Inc. All rights reserved.</div>
</body></html>
